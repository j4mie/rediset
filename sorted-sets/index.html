<html><head><title> Sorted sets / rediset</title><link rel="stylesheet" href="../_dmedia/bootstrap.css"/><link rel="stylesheet" href="../_dmedia/tango.css"/><link rel="stylesheet/less" type="text/css" href="../_dmedia/style.less"/><script src="../_dmedia/less.js" type="text/javascript">
        </script></head><body class="content">
        <div class="wrap">
            <header><h1><a href="..">rediset</a></h1></header><div class="markdown">
<h1 id="sorted-sets"><a href="">Sorted sets</a></h1><p>Rediset can also manipulate <em>sorted</em> sets.</p>
<blockquote>
<p>Redis Sorted Sets are, similarly to Redis Sets, non repeating collections
of Strings. The difference is that every member of a Sorted Set is associated
with score, that is used in order to take the sorted set ordered, from the
smallest to the greatest score. While members are unique, scores may be
repeated.</p>
</blockquote>
<p>The basic interface is very similar to the <code>Set</code> API:</p>
<div class="codehilite"><pre><span class="o">&gt;&gt;&gt;</span> <span class="n">from</span> <span class="n">rediset</span> <span class="nb">import</span> <span class="n">Rediset</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">rs</span> <span class="o">=</span> <span class="n">Rediset</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">s</span> <span class="o">=</span> <span class="n">rs</span><span class="o">.</span><span class="n">SortedSet</span><span class="p">(</span><span class="s">'somekey'</span><span class="p">)</span>
</pre></div>


<p>Members of a sorted set are represented as 2-tuples of <code>(element, score)</code>:</p>
<div class="codehilite"><pre><span class="o">&gt;&gt;&gt;</span> <span class="n">s</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="s">'a'</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">s</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="s">'b'</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="s">'c'</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">s</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s">'b'</span><span class="p">)</span>
</pre></div>


<p>Like unsorted sets, you can perform Pythonic operations on sorted sets:</p>
<div class="codehilite"><pre><span class="o">&gt;&gt;&gt;</span> <span class="n">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="mi">2</span>
<span class="o">&gt;&gt;&gt;</span> <span class="s">'a'</span> <span class="n">in</span> <span class="n">s</span>
<span class="n">True</span>
<span class="o">&gt;&gt;&gt;</span> <span class="s">'b'</span> <span class="n">in</span> <span class="n">s</span>
<span class="n">False</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">set</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="n">set</span><span class="p">([</span><span class="s">'a'</span><span class="p">,</span> <span class="s">'c'</span><span class="p">])</span>
<span class="o">&gt;&gt;&gt;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="p">[</span><span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="n">in</span> <span class="n">s</span><span class="p">]</span>
<span class="p">[</span><span class="s">'a'</span><span class="p">,</span> <span class="s">'c'</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="p">[</span><span class="s">'a'</span><span class="p">]</span>
</pre></div>


<p>Sorted sets have some extra useful methods. These map closely to the equivalent
functions in redis-py, so please look at its documentation for more information.</p>
<div class="codehilite"><pre><span class="o">&gt;&gt;&gt;</span> <span class="n">s</span><span class="o">.</span><span class="n">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="p">[</span><span class="s">'a'</span><span class="p">,</span> <span class="s">'c'</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">s</span><span class="o">.</span><span class="n">members</span><span class="p">()</span> <span class="c1"># equivalent to s.range(0, -1)</span>
<span class="p">[</span><span class="s">'a'</span><span class="p">,</span> <span class="s">'c'</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">s</span><span class="o">.</span><span class="n">members</span><span class="p">(</span><span class="n">desc</span><span class="o">=</span><span class="n">True</span><span class="p">)</span>
<span class="p">[</span><span class="s">'c'</span><span class="p">,</span> <span class="s">'a'</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">s</span><span class="o">.</span><span class="n">members</span><span class="p">(</span><span class="n">withscores</span><span class="o">=</span><span class="n">True</span><span class="p">)</span>
<span class="p">[(</span><span class="s">'a'</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span> <span class="p">(</span><span class="s">'c'</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">)]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">s</span><span class="o">.</span><span class="n">members</span><span class="p">(</span><span class="n">withscores</span><span class="o">=</span><span class="n">True</span><span class="p">,</span> <span class="n">score_cast_func</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
<span class="p">[(</span><span class="s">'a'</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="s">'c'</span><span class="p">,</span> <span class="mi">3</span><span class="p">)]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">s</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="s">'c'</span><span class="p">)</span>
<span class="mf">3.0</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">s</span><span class="o">.</span><span class="n">increment</span><span class="p">(</span><span class="s">'c'</span><span class="p">)</span>
<span class="mf">4.0</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">s</span><span class="o">.</span><span class="n">decrement</span><span class="p">(</span><span class="s">'c'</span><span class="p">,</span> <span class="n">amount</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="mf">2.0</span>
</pre></div>


<p>Sorted sets also support <em>range views</em>, which are used to pass arguments to the
underlying zrange calls while still allowing Pythonic slicing syntax. The two
provided range views are <code>withscores</code> and <code>descending</code>:</p>
<div class="codehilite"><pre><span class="o">&gt;&gt;&gt;</span> <span class="sr">s[0]</span>
<span class="err">'a'</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">s</span><span class="o">.</span><span class="n">descending</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="s">'c'</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">s</span><span class="o">.</span><span class="n">withscores</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="p">(</span><span class="s">'a'</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">s</span><span class="o">.</span><span class="n">descending</span><span class="o">.</span><span class="n">withscores</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="p">(</span><span class="s">'c'</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">)</span>
</pre></div>


<h2 id="sorted-set-operations">Sorted set operations</h2>
<p>You can perform operations on sorted sets, just as you can with ordinary sets.
Note that only <code>Intersection</code> and <code>Union</code> are supported, not <code>Difference</code> (this
is because these are the only sorted set operations supported by Redis).</p>
<div class="codehilite"><pre><span class="o">&gt;&gt;&gt;</span> <span class="n">s1</span> <span class="o">=</span> <span class="n">rs</span><span class="o">.</span><span class="n">SortedSet</span><span class="p">(</span><span class="s">'key1'</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">s1</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="s">'a'</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="s">'b'</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">s2</span> <span class="o">=</span> <span class="n">rs</span><span class="o">.</span><span class="n">SortedSet</span><span class="p">(</span><span class="s">'key2'</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">s2</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="s">'b'</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="s">'c'</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">i</span> <span class="o">=</span> <span class="n">rs</span><span class="o">.</span><span class="n">Intersection</span><span class="p">(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">i</span><span class="o">.</span><span class="n">members</span><span class="p">()</span>
<span class="p">[</span><span class="s">'b'</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">i</span><span class="o">.</span><span class="n">members</span><span class="p">(</span><span class="n">withscores</span><span class="o">=</span><span class="n">True</span><span class="p">)</span> <span class="c1"># default aggregation is SUM</span>
<span class="p">[(</span><span class="s">'b'</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">)]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">i2</span> <span class="o">=</span> <span class="n">rs</span><span class="o">.</span><span class="n">Intersection</span><span class="p">(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">,</span> <span class="n">aggregate</span><span class="o">=</span><span class="s">'MAX'</span><span class="p">)</span> <span class="c1"># custom aggregation</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">i2</span><span class="o">.</span><span class="n">members</span><span class="p">(</span><span class="n">withscores</span><span class="o">=</span><span class="n">True</span><span class="p">)</span>
<span class="p">[(</span><span class="s">'b'</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">)]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">i3</span> <span class="o">=</span> <span class="n">rs</span><span class="o">.</span><span class="n">Intersection</span><span class="p">(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">,</span> <span class="n">aggregate</span><span class="o">=</span><span class="s">'MIN'</span><span class="p">)</span> <span class="c1"># custom aggregation</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">i3</span><span class="o">.</span><span class="n">members</span><span class="p">(</span><span class="n">withscores</span><span class="o">=</span><span class="n">True</span><span class="p">)</span>
<span class="p">[(</span><span class="s">'b'</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">)]</span>
</pre></div>


<p>Note that you can't mix sets with sorted sets:</p>
<div class="codehilite"><pre><span class="o">&gt;&gt;&gt;</span> <span class="n">s1</span> <span class="o">=</span> <span class="n">rs</span><span class="o">.</span><span class="n">SortedSet</span><span class="p">(</span><span class="s">'key1'</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">s2</span> <span class="o">=</span> <span class="n">rs</span><span class="o">.</span><span class="n">Set</span><span class="p">(</span><span class="s">'key2'</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">s1</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="s">'a'</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="s">'b'</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">s2</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">'c'</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">i</span> <span class="o">=</span> <span class="n">rs</span><span class="o">.</span><span class="n">Intersection</span><span class="p">(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)</span>
<span class="n">TypeError:</span> <span class="n">Sets</span> <span class="ow">and</span> <span class="n">SortedSets</span> <span class="n">cannot</span> <span class="n">be</span> <span class="n">mixed</span>
</pre></div>


<p>You can perform weighted set operations by passing in (set, weight) tuples into the operation constructors:</p>
<div class="codehilite"><pre><span class="o">&gt;&gt;&gt;</span> <span class="n">i4</span> <span class="o">=</span> <span class="n">rs</span><span class="o">.</span><span class="n">Intersection</span><span class="p">((</span><span class="n">s1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span> <span class="p">(</span><span class="n">s2</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
</pre></div>
                </div>
            <footer><p><a href="http://github.com/j4mie/rediset"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://a248.e.akamai.net/assets.github.com/img/e6bef7a091f5f3138b8cd40bc3e114258dd68ddf/687474703a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f7265645f6161303030302e706e67" alt="Fork me on GitHub"/></a></p>
<p><a href="http://dabapps.com"><img src="http://dabapps.com/static/media/images/template/dabapps-logo.png" width="100" alt="DabApps logo" title="DabApps logo"/></a></p>
<p>Created by Jamie Matthews. <a href="http://twitter.com/j4mie">Follow me on Twitter</a>.</p></footer></div>
    </body></html>